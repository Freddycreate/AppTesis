{% extends 'base.html' %}
{% block content %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <div class="container mt-5">
        <h6 class="mb-3"><b>Seleccione el rango de fecha</b></h6>
        <div class="row mb-3">
            <div class="col-md-3">
                <label for="start_date" class="form-label">Fecha de inicio:</label>
                <input type="date" id="start_date" class="form-control">
            </div>
            <div class="col-md-3">
                <label for="end_date" class="form-label">Fecha de fin:</label>
                <input type="date" id="end_date" class="form-control">
            </div>
            <div class="col-md-2">
                <button onclick="filterData()" class="btn btn-primary mt-4">Filtrar</button>
            </div>
    </div>
    <br><br>
        <div id="chart"></div>
    </div>

        <script>
            var datos_grafico = {{ datos_grafico|safe }};
            var initialLabels = datos_grafico.labels;
            var initialViscosidades = datos_grafico.viscosidades;
            var initialResiduos = datos_grafico.residuos;

            function filterData() {
                var start_date = document.getElementById('start_date').value;
                var end_date = document.getElementById('end_date').value;

                var filteredLabels = [];
                var filteredViscosidades = [];
                var filteredResiduos = [];

                for (var i = 0; i < initialLabels.length; i++) {
                    if (start_date <= initialLabels[i] && initialLabels[i] <= end_date) {
                        filteredLabels.push(initialLabels[i]);
                        filteredViscosidades.push(initialViscosidades[i]);
                        filteredResiduos.push(initialResiduos[i]);
                    }
                }

                var options = {
                  chart: {
                    height: 350,
                    type: "line",
                    stacked: false
                  },
                  dataLabels: {
                    enabled: false
                  },
                  colors: ["#FF1654", "#247BA0"],
                  series: [
                    {
                      name: "Viscosidad",
                      data: filteredViscosidades
                    },
                    {
                      name: "Residuo",
                      data: filteredResiduos
                    }
                  ],
                  stroke: {
                    width: [1, 1]
                  },
                  plotOptions: {
                    bar: {
                      columnWidth: "40%"
                    }
                  },
                  xaxis: {
                    categories: filteredLabels
                  },
                  yaxis: [
                    {
                      axisTicks: {
                        show: true
                      },
                      axisBorder: {
                        show: true,
                        color: "#FF1654"
                      },
                      labels: {
                        style: {
                          colors: "#FF1654"
                        }
                      },
                      title: {
                        text: "Viscosidad",
                        style: {
                          color: "#FF1654"
                        }
                      }
                    },
                    {
                      opposite: true,
                      axisTicks: {
                        show: true
                      },
                      axisBorder: {
                        show: true,
                        color: "#247BA0"
                      },
                      labels: {
                        style: {
                          colors: "#247BA0"
                        }
                      },
                      title: {
                        text: "Residuo",
                        style: {
                          color: "#247BA0"
                        }
                      }
                    }
                  ],
                  tooltip: {
                    shared: false,
                    intersect: true,
                    x: {
                      show: false
                    }
                  },
                  legend: {
                    horizontalAlign: "left",
                    offsetX: 40
                  }
               };

                var chart = new ApexCharts(document.querySelector("#chart"), options);

                chart.render();
            }

            filterData();

        </script>
    </body>
{% endblock %}