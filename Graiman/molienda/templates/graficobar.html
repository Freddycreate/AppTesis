{% extends 'base.html' %}
{% block content %}
    <title>Gráfico de Líneas</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <h6><b>Seleccione un rango de fechas</b></h6>
    <body>
        <form method="get" action="">
            <label for="start_date">Fecha de inicio:</label>
            <input type="date" id="start_date" name="start_date" value="{{ request.GET.start_date }}">
            <label for="end_date">Fecha de fin:</label>
            <input type="date" id="end_date" name="end_date" value="{{ request.GET.end_date }}">
            <button type="submit">Filtrar</button>
        </form>
    <br><br>
    <h6><b>Control de Parámetros de la Barbotina</b></h6>
        <div id="chart"></div>
        <script>
            var datos_grafico = {{ datos_grafico|safe }};
            var initialLabels = datos_grafico.labels;
            var initialViscosidades = datos_grafico.viscosidades;
            var initialResiduos = datos_grafico.residuos;

            function filterData() {
                var start_date = document.getElementById('start_date').value;
                var end_date = document.getElementById('end_date').value;

                var filteredLabels = [];
                var filteredViscosidades = [];
                var filteredResiduos = [];

                for (var i = 0; i < initialLabels.length; i++) {
                    if (start_date <= initialLabels[i] && initialLabels[i] <= end_date) {
                        filteredLabels.push(initialLabels[i]);
                        filteredViscosidades.push(initialViscosidades[i]);
                        filteredResiduos.push(initialResiduos[i]);
                    }
                }

                var options = {
                  chart: {
                    height: 350,
                    type: "line",
                    stacked: false
                  },
                  dataLabels: {
                    enabled: false
                  },
                  colors: ["#FF1654", "#247BA0"],
                  series: [
                    {
                      name: "Viscosidad",
                      data: filteredViscosidades
                    },
                    {
                      name: "Residuo",
                      data: filteredResiduos
                    }
                  ],
                  stroke: {
                    width: [1, 1]
                  },
                  plotOptions: {
                    bar: {
                      columnWidth: "40%"
                    }
                  },
                  xaxis: {
                    categories: filteredLabels
                  },
                  yaxis: [
                    {
                      axisTicks: {
                        show: true
                      },
                      axisBorder: {
                        show: true,
                        color: "#FF1654"
                      },
                      labels: {
                        style: {
                          colors: "#FF1654"
                        }
                      },
                      title: {
                        text: "Viscosidad",
                        style: {
                          color: "#FF1654"
                        }
                      }
                    },
                    {
                      opposite: true,
                      axisTicks: {
                        show: true
                      },
                      axisBorder: {
                        show: true,
                        color: "#247BA0"
                      },
                      labels: {
                        style: {
                          colors: "#247BA0"
                        }
                      },
                      title: {
                        text: "Residuo",
                        style: {
                          color: "#247BA0"
                        }
                      }
                    }
                  ],
                  tooltip: {
                    shared: false,
                    intersect: true,
                    x: {
                      show: false
                    }
                  },
                  legend: {
                    horizontalAlign: "left",
                    offsetX: 40
                  }
               };

                var chart = new ApexCharts(document.querySelector("#chart"), options);

                chart.render();
            }

            filterData();

        </script>
    </body>
{% endblock %}

